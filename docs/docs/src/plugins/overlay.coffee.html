<!DOCTYPE html><html><head><title>overlay.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../index.html" class="source"><span class="file_name">README</span></a><a href="../../src/hallo.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">hallo.coffee</span></a><a href="../../src/plugins/lists.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">lists.coffee</span></a><a href="../../src/plugins/headings.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">headings.coffee</span></a><a href="../../src/plugins/overlay.coffee.html" class="source selected"><span class="base_path">src / plugins / </span><span class="file_name">overlay.coffee</span></a><a href="../../src/plugins/toolbarlinebreak.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">toolbarlinebreak.coffee</span></a><a href="../../src/plugins/image.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">image.coffee</span></a><a href="../../src/plugins/halloformat.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">halloformat.coffee</span></a><a href="../../src/plugins/reundo.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">reundo.coffee</span></a><a href="../../src/plugins/block.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">block.coffee</span></a><a href="../../src/plugins/link.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">link.coffee</span></a><a href="../../src/plugins/justify.coffee.html" class="source "><span class="base_path">src / plugins / </span><span class="file_name">justify.coffee</span></a><a href="../../src/widgets/button.coffee.html" class="source "><span class="base_path">src / widgets / </span><span class="file_name">button.coffee</span></a><a href="../../src/widgets/dropdownbutton.coffee.html" class="source "><span class="base_path">src / widgets / </span><span class="file_name">dropdownbutton.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>overlay.coffee</h1><div class="filepath">src/plugins/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div><pre><code>Hallo - a rich text editing jQuery UI widget
(c) 2011 Henri Bergius, IKS Consortium
Hallo may be freely distributed under the MIT license
</code></pre>

<hr />

<pre><code>Hallo overlay plugin
(c) 2011 Liip AG, Switzerland
This plugin may be freely distributed under the MIT license.
</code></pre>

<p>The overlay plugin adds an overlay around the editable element.
It has no direct dependency with other plugins, but requires the
"floating" hallo option to be false to look nice. Furthermore, the
toolbar should have the same width as the editable element.</p>
</td><td class="code"><div class="highlight"><pre><span class="p">(</span><span class="nf">(jQuery) -&gt;</span>
    <span class="nx">jQuery</span><span class="p">.</span><span class="nx">widget</span> <span class="s2">&quot;Liip.hallooverlay&quot;</span><span class="p">,</span>
        <span class="nv">options:</span>
            <span class="nv">editable: </span><span class="kc">null</span>
            <span class="nv">toolbar: </span><span class="kc">null</span>
            <span class="nv">uuid: </span><span class="s2">&quot;&quot;</span>
            <span class="nv">overlay: </span><span class="kc">null</span>
            <span class="nv">padding: </span><span class="mi">10</span>
            <span class="nv">background: </span><span class="kc">null</span>

        <span class="nv">_create: </span><span class="o">-&gt;</span>
            <span class="nv">widget = </span><span class="k">this</span>

            <span class="k">if</span> <span class="o">not</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">bound</span>
                <span class="vi">@options.bound = </span><span class="kc">true</span>
                <span class="nx">widget</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">editable</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">bind</span> <span class="s2">&quot;halloactivated&quot;</span><span class="p">,</span> <span class="nf">(event, data) -&gt;</span>
                    <span class="nv">widget.options.currentEditable = </span><span class="nx">jQuery</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">)</span>
                    <span class="k">if</span> <span class="o">!</span><span class="nx">widget</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">visible</span>
                        <span class="nx">widget</span><span class="p">.</span><span class="nx">showOverlay</span><span class="p">()</span>

                <span class="nx">widget</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">editable</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">bind</span> <span class="s2">&quot;hallomodified&quot;</span><span class="p">,</span> <span class="nf">(event, data) -&gt;</span>
                    <span class="nv">widget.options.currentEditable = </span><span class="nx">jQuery</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nx">widget</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">visible</span>
                        <span class="nx">widget</span><span class="p">.</span><span class="nx">resizeOverlay</span><span class="p">()</span>

                <span class="nx">widget</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">editable</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">bind</span> <span class="s2">&quot;hallodeactivated&quot;</span><span class="p">,</span> <span class="nf">(event, data) -&gt;</span>
                    <span class="nv">widget.options.currentEditable = </span><span class="nx">jQuery</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nx">widget</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">visible</span>
                        <span class="nx">widget</span><span class="p">.</span><span class="nx">hideOverlay</span><span class="p">()</span>

        <span class="nv">_init: </span><span class="o">-&gt;</span>

        <span class="nv">showOverlay: </span><span class="o">-&gt;</span>
            <span class="vi">@options.visible = </span><span class="kc">true</span>
            <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">overlay</span> <span class="o">is</span> <span class="kc">null</span>
                <span class="k">if</span> <span class="nx">jQuery</span><span class="p">(</span><span class="s2">&quot;#halloOverlay&quot;</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
                    <span class="vi">@options.overlay = </span><span class="nx">jQuery</span><span class="p">(</span><span class="s2">&quot;#halloOverlay&quot;</span><span class="p">)</span>
                <span class="k">else</span>
                    <span class="vi">@options.overlay = </span><span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;&lt;div id=&quot;halloOverlay&quot; class=&quot;halloOverlay&quot;&gt;&#39;</span><span class="p">)</span>
                    <span class="nx">jQuery</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">append</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">overlay</span>

                <span class="nx">@options</span><span class="p">.</span><span class="nx">overlay</span><span class="p">.</span><span class="nx">bind</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="nx">@options</span><span class="p">.</span><span class="nx">editable</span><span class="p">.</span><span class="nx">turnOff</span><span class="p">,</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">editable</span><span class="p">)</span>

            <span class="nx">@options</span><span class="p">.</span><span class="nx">overlay</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">background</span> <span class="o">is</span> <span class="kc">null</span>
                <span class="k">if</span> <span class="nx">jQuery</span><span class="p">(</span><span class="s2">&quot;#halloBackground&quot;</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
                    <span class="vi">@options.background = </span><span class="nx">jQuery</span><span class="p">(</span><span class="s2">&quot;#halloBackground&quot;</span><span class="p">)</span>
                <span class="k">else</span>
                    <span class="vi">@options.background = </span><span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;&lt;div id=&quot;halloBackground&quot; class=&quot;halloBackground&quot;&gt;&#39;</span><span class="p">)</span>
                    <span class="nx">jQuery</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">append</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">background</span>


            <span class="nx">@resizeOverlay</span><span class="p">()</span>
            <span class="nx">@options</span><span class="p">.</span><span class="nx">background</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>

            <span class="k">if</span> <span class="o">not</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">originalZIndex</span>
                <span class="vi">@options.originalZIndex = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">currentEditable</span><span class="p">.</span><span class="nx">css</span> <span class="s2">&quot;z-index&quot;</span>
            <span class="nx">@options</span><span class="p">.</span><span class="nx">currentEditable</span><span class="p">.</span><span class="nx">css</span> <span class="s1">&#39;z-index&#39;</span><span class="p">,</span> <span class="s1">&#39;350&#39;</span>

        <span class="nv">resizeOverlay: </span><span class="o">-&gt;</span>
            <span class="nv">offset = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">currentEditable</span><span class="p">.</span><span class="nx">offset</span><span class="p">()</span>
            <span class="nx">@options</span><span class="p">.</span><span class="nx">background</span><span class="p">.</span><span class="nx">css</span> <span class="p">{</span><span class="nv">top: </span><span class="nx">offset</span><span class="p">.</span><span class="nx">top</span> <span class="o">-</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">padding</span><span class="p">,</span> <span class="nv">left: </span><span class="nx">offset</span><span class="p">.</span><span class="nx">left</span> <span class="o">-</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">padding</span><span class="p">}</span>
            <span class="nx">@options</span><span class="p">.</span><span class="nx">background</span><span class="p">.</span><span class="nx">width</span><span class="p">(</span><span class="nx">@options</span><span class="p">.</span><span class="nx">currentEditable</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">padding</span><span class="p">)</span>
            <span class="nx">@options</span><span class="p">.</span><span class="nx">background</span><span class="p">.</span><span class="nx">height</span><span class="p">(</span><span class="nx">@options</span><span class="p">.</span><span class="nx">currentEditable</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">padding</span><span class="p">)</span>

        <span class="nv">hideOverlay: </span><span class="o">-&gt;</span>
            <span class="vi">@options.visible = </span><span class="kc">false</span>
            <span class="nx">@options</span><span class="p">.</span><span class="nx">overlay</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
            <span class="nx">@options</span><span class="p">.</span><span class="nx">background</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>

            <span class="nx">@options</span><span class="p">.</span><span class="nx">currentEditable</span><span class="p">.</span><span class="nx">css</span> <span class="s1">&#39;z-index&#39;</span><span class="p">,</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">originalZIndex</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>Find the closest parent having a background color. If none, returns white.</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">_findBackgroundColor: </span><span class="nf">(jQueryfield) -&gt;</span>
            <span class="nv">color = </span><span class="nx">jQueryfield</span><span class="p">.</span><span class="nx">css</span> <span class="s2">&quot;background-color&quot;</span>
            <span class="k">if</span> <span class="nx">color</span> <span class="o">isnt</span> <span class="s1">&#39;rgba(0, 0, 0, 0)&#39;</span> <span class="o">and</span> <span class="nx">color</span> <span class="o">isnt</span> <span class="s1">&#39;transparent&#39;</span>
                <span class="k">return</span> <span class="nx">color</span>

            <span class="k">if</span> <span class="nx">jQueryfield</span><span class="p">.</span><span class="o">is</span> <span class="s2">&quot;body&quot;</span>
                <span class="k">return</span> <span class="s2">&quot;white&quot;</span>
            <span class="k">else</span>
                <span class="k">return</span> <span class="nx">@_findBackgroundColor</span> <span class="nx">jQueryfield</span><span class="p">.</span><span class="nx">parent</span><span class="p">()</span>

<span class="p">)(</span><span class="nx">jQuery</span><span class="p">)</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Tue Mar 27 2012 16:14:07 GMT+0200 (CEST)  </div><div id="projectname"><a href="../../index.html">Hallo Editor</a></div></div></body></html>